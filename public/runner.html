<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Runner</title>
    <style>
        :root {
            color-scheme: light dark;
        }

        body {
            font-family: system-ui, sans-serif;
            margin: 0;
            padding: 12px;
        }

        #log {
            white-space: pre-wrap;
            background: rgba(0, 0, 0, .06);
            padding: 8px;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div id="log"></div>
    <script src="./runner-utils.js"></script>
    <script>
        const logContainerElement = RunnerUtilities.findLogContainerElement(document);
        RunnerUtilities.overrideConsoleMethods(logContainerElement);
        RunnerUtilities.registerGlobalErrorListeners(logContainerElement);
    </script>
    <script type="module">
        const { RUNNER_CONSTANTS, extractEntryModuleUrl, waitForEntryModule } = RunnerUtilities;

        async function initializeRunnerPage() {
            const entryModuleUrl = extractEntryModuleUrl(window.location.search);

            if (!entryModuleUrl) {
                console.error(RUNNER_CONSTANTS.missingEntryMessage);

                return;
            }

            console.log(RUNNER_CONSTANTS.entryLogPrefix, entryModuleUrl);

            const entryModuleReady = await waitForEntryModule(entryModuleUrl);
            if (!entryModuleReady) {
                console.error(RUNNER_CONSTANTS.entryNotReadyMessage);
                Ñ‘
                return;
            }

            try {
                await import(entryModuleUrl);
            } catch (entryModuleImportError) {
                console.error(RUNNER_CONSTANTS.entryImportFailedMessage, entryModuleImportError);
            }
        }

        initializeRunnerPage();
    </script>
</body>

</html>